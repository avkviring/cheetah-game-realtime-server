# Mesh сеть для kubernetes

## Статус

Принято

## Контекст и постановка проблемы

- необходимо отслеживать скорость выполнения grpc запросов внутри кластера;
- необходимо масштабировать grpc запросы, так как http/2 обеспечивает постоянное соединение, то распределение; нагрузки
  через kubernetes сервис не работает;
- необходимы поддержка повторения запросов если запрос не выполнился, это касается и внешних запросов;

## Варианты решения

### Поддержка внутри сервиса

Каждый сервис может сам поддерживать и статистику и масштабирование.

"+"

- просто, быстро, надежно

"-"

- много добавочного кода в сервисе
- поддержка мягких релизов требует еще дополнительного кода
- повтор клиентских запросов потребует изменения клиента

### Service mesh

Автоматическая поддержка необходимого функционала без изменения исходного кода.

"+"

- нет изменений в коде сервисов/клиента
- поддержка мягких релизов
- статистика
- диаграмма взаимодействия

"-"

- возможно, меньшая скорость прохождения вызовов
- привязка к kubernetes

### Выбор реализации с поддержкой grpc

- Istio
- Linkerd

Выбор пал на Linkerd, она проще, быстрее и написана на rust :-)

## Внедрение

- установка helm linkerd - ядро системы, его достаточно для работы mesh;
- установка helm linkerd-viz - web панель для мониторинга, требует prometheus и grafana, может установить свои,но раз у
  нас они уже установлены - будем их и использовать;
- добавить аннотацию linkerd.io/inject: enabled в нужные сервисы, включая базы данных и систему мониторинга
  (по-возможности)







